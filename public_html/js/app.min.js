"use strict";window.application={controllers:{},services:{},config:{}},window.application.config={base:{url:location.origin+"/"},api:{url:location.origin+"/api/v1/"}},function(e,n){window.application.services.feedback={write:function(e){return fetch(n.api.url+"feedback",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"},credentials:"include"})}}}(application.services,application.config),function(n){window.application.services.login={signin:function(e){return fetch(n.api.url+"signin",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"},credentials:"same-origin"})},signup:function(e){return fetch(n.api.url+"signup",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"},credentials:"same-origin"})}}}(application.config),function(e,n){e.media={upload:function(e){return fetch(n.api.url+"media",{method:"POST",body:e,headers:{"Content-Disposition":'attachment; filename="avatar.png"'}})}}}(application.services,application.config),function(e,n,t){var a=document.querySelector("#js-feedback-writing");if(a){var i=a.querySelector("form"),r=i.querySelector("button[type=submit]"),o=a.querySelectorAll(".ui.checkbox"),s=a.querySelector("textarea"),c={message:"",rate:"good",recaptcha:""},u=["message","recaptcha"],l=a.querySelector("#js-message-errors"),p=a.querySelector("#js-message-success"),d=function(){0===u.length?r.disabled=!1:r.disabled=!0};d();var f=function(n){var e=a.querySelector("#js-field-"+n);if(e){var t=e.querySelector(".label");u.map(function(e){n===e?t.classList.remove("hidden"):t.classList.add("hidden")})}},m=function(n){u.map(function(e){e===n&&u.splice(u.indexOf(n),1)}),f(n),d()};s.addEventListener("input",function(e){e.preventDefault();var n,t=e.target.value;0<t.length?m("message"):(n="message",u.map(function(e){e===n&&u.splice(u.indexOf(n),1)}),u.push(n),f(n),d()),c.message=t}),$(o).checkbox({onChange:function(){c.rate=this.value}}),window.onloadRecaptcha=function(){e.render("g-recaptcha",{sitekey:"6LfgRGYUAAAAAM_0AbtnPtio6mnTqBP0kz05q-Bl",callback:function(e){e&&m("recaptcha"),c.recaptcha=e}})},i.addEventListener("submit",function(e){e.preventDefault(),0<u.length||n.write(c).then(function(e){return e.json()}).then(function(e){if(e.success)$(p).dimmer("show"),setTimeout(function(){location=t.base.url},2e3);else{$(l).dimmer("show");var n="<ul>";e.errors.map(function(e){n+="<li>"+e+"</li>"}),n+="</ul>",l.querySelector(".sub.header").innerHTML=n}})})}}(window.grecaptcha,application.services.feedback,application.config),function(t,n){var a=document.querySelector("#js-sign-in");if(a){var i=a.querySelector("form");i.onsubmit=function(e){e.preventDefault(),n.signin({username:i.querySelector("input[name=email]").value,password:i.querySelector("input[name=password]").value}).then(function(e){return e.json()}).then(function(e){if(e.success)$("#js-message-success").dimmer("show"),setTimeout(function(){$("#js-message-success").dimmer("hide"),location=t.base.url},2e3);else{$("#js-message-errors").dimmer("show");var n="<ul>";e.errors.map(function(e){n+="<li>"+e+"</li>"}),n+="</ul>",a.querySelector("#js-message-errors").querySelector(".sub.header").innerHTML=n}})}}}(application.config,application.services.login),function(t,n,a){var i=document.querySelector("#js-sign-up");if(i){var e=i.querySelector("form"),r=i.querySelector(".ui.modal"),o=r.querySelector("#js-cropper-save"),s=(r.querySelector("#js-cropper-cancel"),i.querySelector("#js-upload-file")),c=null,u=i.querySelector("#js-cropper-image"),l=i.querySelector("input[name=username]"),p=i.querySelector("input[name=email]"),d=i.querySelector("input[name=phone]"),f=i.querySelector("input[name=password]"),m=i.querySelector("input[name=password-repeat]"),g=i.querySelector("button[type=submit]"),h={avatar:"http://icons.iconarchive.com/icons/paomedia/small-n-flat/1024/user-male-icon.png",username:"",email:"",phone:"",password:"",passwordRepeat:""};$("input[name=phone]").mask("(000) 000-00-00"),g.disabled=!0;var v=function(){0<y.length?g.disabled=!0:g.disabled=!1},y=["username","email","password","password-repeat"],S=function(n){var e=i.querySelector("input[name="+n+"]");e&&e.nextElementSibling.classList.add("hidden"),y.forEach(function(e){e===n&&y.splice(y.indexOf(n),1)})},w=function(n){var e=i.querySelector("input[name="+n+"]");(e=i.querySelector("input[name="+n+"]"))&&e.nextElementSibling.classList.remove("hidden"),y.forEach(function(e){e===n&&y.splice(y.indexOf(n),1)}),y.push(n)};s.addEventListener("change",function(e){if(e.target.files&&e.target.files[0]){var n=new FileReader;n.onload=function(e){var n=e.target.result;u.src=n,c=new Cropper(u,{dragCrop:!1,autoCropArea:0,highlight:!1,zoomable:!1,checkCrossOrigin:!1,modal:!0,guides:!0,center:!0,background:!0,autoCrop:!0,cropBoxMovable:!0,aspectRatio:1}),$(r).modal("show")},n.readAsDataURL(e.target.files[0])}}),o.addEventListener("click",function(e){e.preventDefault(),c.getCroppedCanvas()&&c.getCroppedCanvas().toBlob(function(e){var n=new File([e],"file"),t=new FormData;t.append("userfile",n),a.upload(t).then(function(e){return e.json()}).then(function(e){e.success&&(h.avatar=e.info)})})}),l.oninput=function(e){e.preventDefault();var n=e.target.value;0<n.length?S("username"):w("username"),h.username=n,v()},p.oninput=function(e){e.preventDefault();var n=e.target.value;e.target.nextElementSibling;/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(n).toLowerCase())?S("email"):w("email"),h.email=n,v()},d.oninput=function(e){e.preventDefault();var n=e.target.value;0<n.length?15===n.length?S("phone"):w("phone"):S("phone"),h.phone=n,v()},f.addEventListener("input",function(e){e.preventDefault();e.target.nextElementSibling;var n=e.target.value;n.length<8?w("password"):S("password"),n!==h.passwordRepeat?w("password-repeat"):S("password-repeat"),h.password=n,v()}),m.addEventListener("input",function(e){e.preventDefault();e.target.nextElementSibling;var n=e.target.value;n!==h.password?w("password-repeat"):S("password-repeat"),h.passwordRepeat=n,v()}),e.onsubmit=function(e){e.preventDefault(),g.disabled=!0,n.signup(h).then(function(e){return e.json()}).then(function(e){if(e.success)$("#js-message-success").dimmer("show"),setTimeout(function(){$("#js-message-success").dimmer("hide"),location=t.base.url+"signin"},2e3);else{g.disabled=!1,$("#js-message-errors").dimmer("show");var n="<ul>";e.errors.map(function(e){n+="<li>"+e+"</li>"}),n+="</ul>",i.querySelector("#js-message-errors").querySelector(".sub.header").innerHTML=n}}).catch(function(e){g.disabled=!1,$("#js-message-error").dimmer("show")})}}}(application.config,application.services.login,application.services.media);